($=>{class PollActivityGraphWidget{constructor(container){this.container=$(container),this.select=this.container.find(".bpolls-activities-list"),this.resultsContainer=this.container.find(".polls-widget__results-container"),this.config="undefined"!=typeof bpolls_wiget_obj?bpolls_wiget_obj:null,this.select.length&&this.init()}init(){this.bindEvents(),this.animateProgressBars()}bindEvents(){this.select.on("change",e=>this.handleSelectChange(e))}handleSelectChange(e){e=$(e.target).val();e&&(this.loadActivityResults(e),this.updateExportLink(e))}getTranslation(key,fallback){return this.config&&this.config.i18n&&this.config.i18n[key]?this.config.i18n[key]:fallback}showLoading(){var loadingHtml=`
				<div class="polls-widget__loading">
					<div class="polls-widget__spinner"></div>
					<span class="polls-widget__loading-text">${this.getTranslation("loading","Loading...")}</span>
				</div>
			`;this.resultsContainer.html(loadingHtml)}loadActivityResults(activityId){this.showLoading(),this.config?$.ajax({url:this.config.ajax_url,type:"POST",data:{action:"bpolls_widget_get_activity_results",activity_id:activityId,security:this.config.ajax_nonce},success:response=>{response.success&&response.data&&response.data.html?(this.resultsContainer.html(response.data.html),this.animateProgressBars()):(response=response.data&&response.data.message?response.data.message:this.getTranslation("error","Failed to load results"),this.showError(response))},error:()=>{this.showError(this.getTranslation("error","Request failed"))}}):this.showError(this.getTranslation("error","Configuration not found"))}animateProgressBars(){setTimeout(()=>{this.resultsContainer.find(".polls-widget__result-fill").each(function(){let $fill=$(this),targetWidth=$fill.css("width");$fill.css("width","0"),setTimeout(()=>{$fill.css("width",targetWidth)},50)})},50)}updateExportLink(activityId){var baseUrl,nonce,exportBtn=this.container.find("#export-poll-data");exportBtn.length&&this.config&&(baseUrl=exportBtn.attr("href").split("&activity_id=")[0],nonce=this.config.csv_export_nonce||"",exportBtn.attr("href",baseUrl+"&activity_id="+activityId+"&_wpnonce="+nonce))}showError(message){this.resultsContainer.html(`
				<div class="polls-widget__empty">
					<svg class="polls-widget__empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<circle cx="12" cy="12" r="10"></circle>
						<line x1="12" y1="8" x2="12" y2="12"></line>
						<line x1="12" y1="16" x2="12.01" y2="16"></line>
					</svg>
					<p class="polls-widget__empty-text">${message}</p>
				</div>
			`)}}class PollReportWidget{constructor(container){this.container=$(container),this.select=this.container.find("#poll_seletect"),this.resultsContainer=this.container.find(".all_polll_result"),this.config="undefined"!=typeof wbpollWidgetConfig?wbpollWidgetConfig:null,this.init()}init(){this.bindEvents(),this.animateProgressBars()}bindEvents(){this.select.on("change",e=>this.handleSelectChange(e))}handleSelectChange(e){e=$(e.target).val();e&&this.loadPollResults(e)}getTranslation(key,fallback){return this.config&&this.config.i18n&&this.config.i18n[key]?this.config.i18n[key]:fallback}showLoading(){var loadingHtml=`
				<div class="polls-widget__loading">
					<div class="polls-widget__spinner"></div>
					<span class="polls-widget__loading-text">${this.getTranslation("loading","Loading results...")}</span>
				</div>
			`;this.resultsContainer.html(loadingHtml)}loadPollResults(pollId){this.showLoading(),this.config?$.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"wbpoll_widget_get_results",poll_id:pollId,nonce:this.config.nonce},success:response=>{response.success&&response.data&&response.data.html?(this.resultsContainer.html(response.data.html),this.animateProgressBars()):(response=response.data&&response.data.message?response.data.message:this.getTranslation("error","Failed to load results"),this.showError(response))},error:()=>{this.showError(this.getTranslation("error","Request failed"))}}):this.showError(this.getTranslation("error","Configuration not found"))}animateProgressBars(){setTimeout(()=>{this.resultsContainer.find(".polls-widget__result-fill").each(function(){let $fill=$(this),targetWidth=$fill.css("width");$fill.css("width","0"),setTimeout(()=>{$fill.css("width",targetWidth)},50)})},50)}showError(message){this.resultsContainer.html(`
				<div class="polls-widget__empty">
					<svg class="polls-widget__empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<circle cx="12" cy="12" r="10"></circle>
						<line x1="12" y1="8" x2="12" y2="12"></line>
						<line x1="12" y1="16" x2="12.01" y2="16"></line>
					</svg>
					<p class="polls-widget__empty-text">${message}</p>
				</div>
			`)}}$(document).ready(function(){$(".widget_bp_poll_graph_widget, .polls-widget--activity-graph").each(function(){new PollActivityGraphWidget(this)}),$(".widget_wb_poll_report, .polls-widget--report").each(function(){new PollReportWidget(this)})}),window.PollActivityGraphWidget=PollActivityGraphWidget,window.PollReportWidget=PollReportWidget})(jQuery);